# 软件包封装

## 软件包发布

1. Tag 是 git 版本库的一个标记， 指向某个 commit 的指针。

推送版本到 Github ，就可以在 Git 上面看到一个版本标记，而且可以提供此版本的 zip 打包下载。实际上这个也可以作为一种软件分发方式，只不过相对于使用 npm 包管理器，没有提供自动依赖安装。

2. 利用 action 自动发布

推送软件到 npm 仓库的方式：

- 使用命令：npm publish;
- 利用 CI 工具实现，即 CD；

3. 推送仓库的触发条件，是在有新的版本发布时，通过判断 publish 提交的方法判定

首先单独划分一个 release 分支，当发布版本时，就建立一个 pull request 到 release 分支，当在 github 上 merge 分支时就触发发布流程。

4. 编写一个 Action 脚本用于自动打包，并推送新的软件包到 npm。

**注意：提交 npm 库时需要认证，我们通过向 npm 申请 token 完成。**

注意，npm token 是敏感信息，不能公开。需要借助 GitHub 的 Action Secret 功能：

> 参考文档：https://github.com/ui-puzzles/trigon/settings/secrets/actions

Action Secret 相当于建立了一个不公开的环境变量。只有项目的所有者可以设定，其他人则看不到。

### 支持哪些模块规范

1. 常见的模块规范：

- IIFE：立即执行函数实现模块化；
- CJS：基于 CommonJS 标准的模块化；
- AMD：使用 require 编写；
- CMD：使用使用 SeaJS 编写；
- ESM：ES 标准的模块化方案；
- UMD：兼容 CJS, AMD, IIFE 规范。

2. 最常用的是三类：ESM, CJS 和 IIFE

- ESM 标准目前已经是前端开发的标配，无论是选用 Webpack 还是 Vite ，都会采用这种模块规范；
- CJS： 大量的存量代码还使用 CJS 规范，完全没有必要因为引入一个库去更改编译规则；
- IIFE：非常适用逻辑简单，无需搭建工程化环境的前端应用。

## 代码压缩和混淆

1. 代码压缩

代码压缩是指去除代码中的空格、制表符、换行符等内容，将代码压缩至几行内容甚至一行，这样可以提高网站的加载速度。

2. 代码混淆

混淆是将代码转换成一种功能上等价，但是难以阅读和理解的形式。混淆的主要目的是增加反向工程的难度，同时也可以相对减少代码的体积，比如将变量名缩短就会减少代码的体积。

## 开发调试

1. SourceMap

SourceMap 就是一个信息文件，里面存储了代码打包转换后的位置信息，实质是一个 json 描述文件，维护了打包前后的代码映射关系。

2. 如果想在浏览器中端点调试代码，或在异常监控工具中定位出错位置，SourceMap 就很有必要。

## 使用 vite

1.  Vite 的构建是通过 rollup 完成的，所以 rollup 中的一些配置通过这个属性传递给 rollup。其中需要配置的两个属性如下：

- external： 作用是将该模块保留在 bundle 之外，比如在数组中添加了 vue ，就是为了不让 vue 打包到组件库中；

- output： 这个配置用于 umd/iife 包中，意思是全局中的某个模块在组件库中叫什么名字
